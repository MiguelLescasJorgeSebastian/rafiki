---
title: Manage wallet addresses
---

import { LinkOut } from '@interledger/docs-design-system'

import { CodeBlock } from '@interledger/docs-design-system'

To allow your account holders the ability to send and receive payments via the Open Payments APIs, you must create at least one wallet address for each account. The wallet address serves as a standardized identifier for a payment account.

You can create wallet addresses for your account holders using the Backend Admin API. Note that at least one asset must be created before the wallet address is created. The `assetId` of the asset must be provided as an input variable when issuing the GraphQL mutation query.

## Creating wallet addresses through a script

One approach to issuing wallet addresses to your account holders is writing a one-time script to loop through your list of account holders and call the `CreateWalletAddress` GraphQL mutation along with the input parameters. The following is an example:

<CodeBlock title='Example CreateWalletAddress Mutation'>

```graphql
// Query:

mutation CreateWalletAddress($input:CreateWalletAddressInput!) {
  createWalletAddress(input:$input) {
    code
    success
    message
    walletAddress {
      id
      createdAt
      publicName
      url
      asset {
        code
        id
        scale
     }
    }
  }
}


// Input parameters **NOTE - `additionalProperties` are optional:

{
  "input": {
  "assetId": "0ddc0b7d-1822-4213-948e-915dda58850b",
  "publicName": "Sarah Marshall",
  "url": "https://example.wallet.com/sarah",
  "additionalProperties": [
    {
      "key": "iban",
      "value": "NL93 8601 1117 947",
      "visibleInOpenPayments": false
    },
    {"key": "nickname", "value": "S Mar", "visibleInOpenPayments": true }
  ]
 }
}
```

</CodeBlock>

<CodeBlock title='Example Successful Response'>

```graphql
{
 "data":
{"createWalletAddress": {
 "code":"200",
 "success":true,
 "message":"Created wallet address",
 "walletAddress": {
   "id":"695e7546-1803-4b45-96b6-6a53f4082018",
   "createdAt":"2023-03-03T09:07:01.107Z",
   "publicName":"Sarah Marshall",         "url":"https://example.wallet.com/sarah",
 "asset": {
"id":"0ddc0b7d-1822-4213-948e-915dda58850b",
           "code":"USD",
           "scale":2
        }
   	 }
     }
   }
}
```

</CodeBlock>

You SHOULD store at least the `walletAddress.id` in their internal database to be able to reference the account and wallet address.

### Create wallet address key

To use the Open Payments APIs, a wallet address must be associated with at least one private-public key pair to sign an API request. One or multiple public keys are linked to the wallet address so that third parties can verify request signatures. The key pair can be added using the `CreateWalletAddressKey` GraphQL mutation. If you create wallet addresses for your account holders via a one-time script, you must call this mutation for each new wallet address.

<CodeBlock title='Example CreateWalletAddressKey Mutation'>

```graphql
// Query:

mutation
CreateWalletAddressKey
($input:CreateWalletAddressKeyInput!)
{
 createWalletAddressKey(input:$input) {
  code
  message
  success
  walletAddressKey
{
id
     walletAddressId
     revoked
     jwk{
      alg
      crv
      kid
      kty
      x
    }

 createdAt
 }
}
}


// Input parameters

{
 "input": {
  "jwk": {
  "kid": "keyid-97a3a431-8ee1-48fc-ac85-70e2f5eba8e5",
  "x":"ubqoInifJ5sssIPPnQR1gVPfmoZnJtPhTkyMXNoJF_8",
  "alg":"EdDSA",
  "kty":"OKP",
  "crv":"Ed25519"
},
"walletAddressId":"695e7546-1803-4b45-96b6-6a53f4082018"
 }}
```

</CodeBlock>

<CodeBlock title='Example Successful Response'>

```graphql
{
 "data": {
  "createWalletAddressKey": {
"code":"200",
"message":"Added Key To Wallet Address",
"success":true,
"walletAddressKey": {
      "id":"f2953571-f10c-44eb-ab41-4450a7ad6771",
"walletAddressId":"695e7546-1803-4b45-96b6-6a53f4082018",
"revoked":false,
"jwk": {
"alg":"EdDSA",
"crv":"Ed25519",
           "kid":"keyid-97a3a431-8ee1-48fc-ac85-70e2f5eba8e5",
           "kty":"OKP",
"x":"ubqoInifJ5sssIPPnQR1gVPfmoZnJtPhTkyMXNoJF_8"
},
      "createdAt":"2023-03-03T09:26:41.424Z"
}
   }
  }
}
```

</CodeBlock>

## Creating wallet addresses dynamically

An alternative approach to creating wallet addresses for your account holders is to generate the addresses dynamically when your Rafiki instance fires the `wallet_address.not_found` webhook event. This event fires when Rafiki does not find the wallet address requested from an Open Payments API call. When receiving this event, you can look up the associated account in your system and call the `CreateWalletAddress` and `CreateWalletAddressKey` mutations to create the wallet address and its associated private-public key pair. Even if you opt to create the initial batch of wallet addresses for your existing account holders via a one-time script, you may implement this process to dynamically create wallet addresses for any new accounts you onboard to your system.
