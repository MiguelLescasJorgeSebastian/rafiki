---
title: Exchange rates
---

import { LinkOut } from '@interledger/docs-design-system'

import { CodeBlock } from '@interledger/docs-design-system'

Every Interledger payment is preceded by a rate probe that estimates the costs for transferring value over the network from the sending account servicing entity to the receiving account servicing entity, which is assessed as a network fee. For the rate probe to succeed, you, as the account servicing entity, must provide your Rafiki instance with the current exchange rate. In addition, you may charge fees on top of the estimated fees for facilitating Interledger payments initiated by your account holders.

Your endpoint must accept `GET` requests and respond in the following format:

| Variable Name        | Type   | Description                                                                                                                  | Required |
| -------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------- | -------- |
| `base`               | String | Asset code represented as <LinkOut href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4127 currency code</LinkOut> e.g. `USD` | Y        |
| `rates`              | Object | Object containing `<asset_code : exchange_rate>` pairs, e.g. `{EUR:0.8930}`                                                  | Y        |
| `rates.<asset_code>` | Number | Exchange rate given `base` and `<asset_code>`                                                                                | Y        |

A successful response will return a status code of `200`. Here is a simple example of a response for the `mock-account-servicing-entity`, which is included as a package bundled with your Rafiki instance.

To configure your Rafiki instance to direct its rate probes to your endpoint, you must specify the URL of your endpoint in the `EXCHANGE_RATES_URL` environment variable. An OpenAPI specification of that endpoint can be found <LinkOut href="https://github.com/interledger/rafiki/blob/main/packages/backend/src/openapi/specs/exchange-rates.yaml">here</LinkOut>.

In addition, you will need to specify the `EXCHANGE_RATES_LIFETIME` environment variable, which determines how long your Rafiki instance will cache exchange rates. By caching exchange rates in Rafiki for a specified period, you will improve performance as Rafiki will not need to request the exchange rate from your endpoint for every payment.

In addition, you must consider your slippage tolerance. As mentioned, before an Interledger payment is made, a rate probe provides a quote that estimates the cost of transferring value over the network. This cost includes fees that connector nodes of the network may charge in exchange rates or even as a forwarding fee for payments denominated in the same asset (e.g. USD). As exchange rates and fees charged by connectors fluctuate, there will likely be a variance between the estimated amount provided in the quote and the actual amount required when the payment is initiated. The default slippage is 1% but can be configured via the `SLIPPAGE` environment variable using a value between 0 and 1. Using the default slippage, a payment of \$1.01 will go through on an initial quote estimated at \$1.00, but payment will not be sent if the total, inclusive of exchange rate and network fees, amounts to \$1.02.

Depending on the particular deployment of your Rafiki instance, these environment variables will be set in a `docker-compose.yaml` file or as part of a Helm chart. Refer to the [environment variables](/integration/deploy-to-prod/environment-variables) page for more details.

## Fees

You may charge fees on top of the estimated network fee for facilitating the transfer. You can specify fixed and variable fees per asset using the Backend Admin API or the Rafiki Admin application provided. How you structure those fees is entirely up to you.

### Backend Admin API

The following is an example of setting a fixed fee of 100 basis points using the `setFee` GraphQL mutation:

<CodeBlock title="Example setFee Mutation">

```graphql
mutation SetFee($input: SetFeeInput!) {
  setFee(input: $input) {
    code
    success
    message
    fee {
      id
      assetId
      type
      fixed
      basisPoints
      createdAt
    }
  }
}
```

</CodeBlock>

A request is sent in JSON format specifying the `assetId`, `type`, `fixed`, and `basisPoints` variables:

- `assetId` - A unique identifier assigned by Rafiki when the asset was created.
- `type` - The type of fee, either `SENDING` or `RECEIVING`.
- `fixed` - A flat, fixed fee.
- `basisPoints` - A variable fee. One basis point fee is equal to 0.01% of the total amount, 100 basis points = 1%, 10000 basis points = 100%

These variables are used in the following request example:

<CodeBlock title="Example Request">

```json
{
  "input": {
    "assetId": "14863f6f-4bda-42ef-8715-bf4762898af8",
    "type": "SENDING",
    "fee": {
      "fixed": 100,
      "basisPoints": 100
    }
  }
}
```

</CodeBlock>

<CodeBlock title="Example Successful Response">

```json
{
  "data": {
    "setFee": {
      "code": "200",
      "success": true,
      "message": "Fee set",
      "fee": {
        "id": "140fd9c0-8f14-4850-9724-102f04d97e69",
        "assetId": "14863f6f-4bda-42ef-8715-bf4762898af8",
        "type": "SENDING",
        "fixed": "100",
        "basisPoints": 100,
        "createdAt": "2023-09-13T14:59:53.435Z"
      }
    }
  }
}
```

</CodeBlock>

### Rafiki Admin application

You may also add fees via the Rafiki Admin application.

<p>
  <mark>Needs link to Rafiki Admin User Guide</mark>
</p>
