---
title: Wallet addresses
---

import { LinkOut } from '@interledger/docs-design-system'
import { CodeBlock } from '@interledger/docs-design-system'

:::danger
Creating key pairs is more of an optional thing than anything. It can stay a part of this doc but it should be its own section. The section should reference the open payments docs somewhere. The key pairs are only needed if the ASE wants to allow their users to use/be OP clients under their wallet addresses.
:::

Each payment account belonging to your users (e.g., customers) must have at least one associated wallet address for the account to be able to send and receive payments over Interledger and Open Payments. A wallet address serves as a publicly shareable standardized ID for a payment account.

:::note
Your Rafiki instance must be set up for at least one asset before wallet addresses can be created as each wallet address must have an asset assigned to it.
:::

## Create wallet addresses

There are a few ways in which you can create wallet addresses.

- [Through a script](#create-wallet-addresses-through-a-script)
- [In response to the `wallet_address.not_found` webhook event](#create-wallet-addresses-in-response-to-a-webhook-event)
- [In the Rafiki Admin app](#create-and-manage-wallet-addresses-using-rafiki-admin)

All wallet addresses must also be associated with at least one [public-private key pair](#create-a-wallet-address-key-pair) to sign API requests. If you use Rafiki Admin to create wallet addresses, this happens automatically.

### Create wallet addresses through a script

Writing your own script that loops through your list of account is one way to batch create wallet addresses for your existing account holders.

Your script must first call the `createWalletAddress` GraphQL mutation, then call the [`createWalletAddressKey`](#create-a-wallet-address-key-pair) mutation for each new wallet address.

We strongly recommend you store at least the `walletAddress.id` in your internal database to be able to reference the account and wallet address later.

<CodeBlock title="createWalletAddress mutation">

```graphql
mutation CreateWalletAddress($input: CreateWalletAddressInput!) {
  createWalletAddress(input: $input) {
    code
    success
    message
    walletAddress {
      id
      createdAt
      publicName
      url
      asset {
        code
        id
        scale
      }
    }
  }
}
```

</CodeBlock>

### Example

<CodeBlock title="Example JSON request">

```json
{
  "input": {
    "assetId": "0ddc0b7d-1822-4213-948e-915dda58850b",
    "publicName": "Sarah Marshall",
    "url": "https://example.wallet.com/sarah",
    "additionalProperties": [
      {
        "key": "iban",
        "value": "NL93 8601 1117 947",
        "visibleInOpenPayments": false
      },
      {
        "key": "nickname",
        "value": "S Mar",
        "visibleInOpenPayments": true
      }
    ]
  }
}
```

</CodeBlock>

| Variable               | Description                                                                                                                                       |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| `assetId`              | The unique ID of the asset, assigned by Rafiki when the asset was created, that the wallet address's underlying payment account is denominated in |
| `publicName`           | The public name associated with the wallet address                                                                                                |
| `url`                  | The wallet address's URL                                                                                                                          |
| `additionalProperties` | Optional [additional properties](/apis/graphql/backend/inputobjects/#additionalpropertyinput) associated with the wallet address                  |

<CodeBlock title="Example JSON response">

```json
{
  "data": {
    "createWalletAddress": {
      "code": "200",
      "success": true,
      "message": "Created wallet address",
      "walletAddress": {
        "id": "695e7546-1803-4b45-96b6-6a53f4082018",
        "createdAt": "2023-03-03T09:07:01.107Z",
        "publicName": "Sarah Marshall",
        "url": "https://example.wallet.com/sarah",
        "asset": {
          "id": "0ddc0b7d-1822-4213-948e-915dda58850b",
          "code": "USD",
          "scale": 2
        }
      }
    }
  }
}
```

</CodeBlock>

### Create wallet addresses in response to a webhook event

The `wallet_address.not_found` event fires when a wallet address is requested through the Open Payments Get Wallet Address API, but Rafiki can't find the address.

When you receive the event, look up the associated account in your system, then call the `createWalletAddress` and `createWalletAddressKey` mutations to create the address and its public-private key pair.

---

## Create a wallet address key pair

A wallet address must be associated with at least one public-private key pair to sign Open Payment API requests. The public key enables clients, such as mobile apps, to verify request signatures.

Add a key pair to a wallet address using the `createWalletAddressKey` GraphQL mutation.

<CodeBlock title='createWalletAddressKey mutation'>

```graphql
mutation CreateWalletAddressKey($input: CreateWalletAddressKeyInput!) {
  createWalletAddressKey(input: $input) {
    code
    message
    success
    walletAddressKey {
      id
      walletAddressId
      revoked
      jwk {
        alg
        crv
        kid
        kty
        x
      }
      createdAt
    }
  }
}
```

</CodeBlock>

#### Example

<CodeBlock title="Example JSON request">

```json
{
  "input": {
    "jwk": {
      "kid": "keyid-97a3a431-8ee1-48fc-ac85-70e2f5eba8e5",
      "x": "ubqoInifJ5sssIPPnQR1gVPfmoZnJtPhTkyMXNoJF_8",
      "alg": "EdDSA",
      "kty": "OKP",
      "crv": "Ed25519"
    },
    "walletAddressId": "695e7546-1803-4b45-96b6-6a53f4082018"
  }
}
```

</CodeBlock>

A JSON web key is a JSON data structure that represents a cryptographic key.

In <LinkOut href='https://datatracker.ietf.org/doc/html/rfc7517#section-4'>
Section 4

</LinkOut> of the JSON Web Key (JWK) specification describes the JWK format and associated
parameters (kty, alg, kid).

In <LinkOut href='https://datatracker.ietf.org/doc/html/rfc7518#section-6'>
Section 6

</LinkOut> of the JSON Web Algorithms (JWA) specification describes the cryptographic
algorithm for keys (incl parameters kty, crv, x)

| Variable          | Description                                  |
| ----------------- | -------------------------------------------- |
| `jwk`             | JSON web key object that represents the keys |
| `kid`             | A key ID that identifies the keys            |
| `x`               | The base64 url-encoded public key            |
| `alg`             | The algorithm used to generate the key pair  |
| `kty`             | .                                            |
| `crv`             | .                                            |
| `walletAddressId` | .                                            |

<CodeBlock title='Example JSON response'>

```json
{
  "data": {
    "createWalletAddressKey": {
      "code": "200",
      "message": "Added Key To Wallet Address",
      "success": true,
      "walletAddressKey": {
        "id": "f2953571-f10c-44eb-ab41-4450a7ad6771",
        "walletAddressId": "695e7546-1803-4b45-96b6-6a53f4082018",
        "revoked": false,
        "jwk": {
          "alg": "EdDSA",
          "crv": "Ed25519",
          "kid": "keyid-97a3a431-8ee1-48fc-ac85-70e2f5eba8e5",
          "kty": "OKP",
          "x": "ubqoInifJ5sssIPPnQR1gVPfmoZnJtPhTkyMXNoJF_8"
        },
        "createdAt": "2023-03-03T09:26:41.424Z"
      }
    }
  }
}
```

</CodeBlock>

## Create and manage wallet addresses using Rafiki Admin

You can create and manage wallet addresses manually through the [Rafiki Admin](/admin/admin-user-guide#create-wallet-address) app. If you use Rafiki Admin to create wallet addresses, it will assign each address a public-private key pair automatically.
